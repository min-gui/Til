name: Wiki to Slack Notification

on:
  gollum:

jobs:
  notify:
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Send Wiki Update to Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          # ê¸°ë³¸ ì •ë³´ ì¶”ì¶œ
          TITLE="${{ github.event.pages[0].title }}"
          ACTION="${{ github.event.pages[0].action }}"
          URL="${{ github.event.pages[0].html_url }}"
          EDITOR="${{ github.event.sender.login }}"
          
          # ì•¡ì…˜ í•œê¸€ ë³€í™˜
          case "$ACTION" in
            "created") ACTION_KR="ìƒì„±" EMOJI="âœ¨" ;;
            "edited") ACTION_KR="ìˆ˜ì •" EMOJI="ğŸ“" ;;
            "deleted") ACTION_KR="ì‚­ì œ" EMOJI="ğŸ—‘ï¸" ;;
            *) ACTION_KR="$ACTION" EMOJI="ğŸ“„" ;;
          esac
          
          # Slack ë©”ì‹œì§€ ì „ì†¡
          curl -X POST "$SLACK_WEBHOOK_URL" \
            -H 'Content-type: application/json' \
            -d '{
              "text": "'"$EMOJI"' Wiki '"$ACTION_KR"': '"$TITLE"'",
              "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "'"$EMOJI"' *'"$TITLE"'* í˜ì´ì§€ê°€ '"$ACTION_KR"'ë˜ì—ˆìŠµë‹ˆë‹¤\nğŸ‘¤ '"$EDITOR"' â€¢ ğŸ“… '"$(TZ='Asia/Seoul' date '+%m/%d %H:%M')"'\n<'"$URL"'|ğŸ“– ë³´ëŸ¬ê°€ê¸°>"
                  }
                }
              ]
            }'
